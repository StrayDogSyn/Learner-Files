import{d4 as t}from"./chunk-CyfV0CVs.js";const e=t=>{let e;const n=new Set,r=(t,r)=>{const s="function"==typeof t?t(e):t;if(!Object.is(s,e)){const t=e;e=(null!=r?r:"object"!=typeof s||null===s)?s:Object.assign({},e,s),n.forEach(n=>n(e,t))}},s=()=>e,o={setState:r,getState:s,getInitialState:()=>a,subscribe:t=>(n.add(t),()=>n.delete(t))},a=e=t(r,s,o);return o},n=t=>t?e(t):e,r=t=>(e,n,r)=>{const s=r.subscribe;return r.subscribe=(t,e,n)=>{let o=t;if(e){const s=(null==n?void 0:n.equalityFn)||Object.is;let a=t(r.getState());o=n=>{const r=t(n);if(!s(a,r)){const t=a;e(a=r,t)}},(null==n?void 0:n.fireImmediately)&&e(a,a)}return s(o)},t(e,n,r)};function s(t,e){let n;try{n=t()}catch(r){return}return{getItem:t=>{var e;const r=t=>null===t?null:JSON.parse(t,void 0),s=null!=(e=n.getItem(t))?e:null;return s instanceof Promise?s.then(r):r(s)},setItem:(t,e)=>n.setItem(t,JSON.stringify(e,void 0)),removeItem:t=>n.removeItem(t)}}const o=t=>e=>{try{const n=t(e);return n instanceof Promise?n:{then:t=>o(t)(n),catch(t){return this}}}catch(n){return{then(t){return this},catch:t=>o(t)(n)}}},a=(t,e)=>(n,r,a)=>{let i={storage:s(()=>localStorage),partialize:t=>t,version:0,merge:(t,e)=>({...e,...t}),...e},c=!1;const l=new Set,u=new Set;let d=i.storage;if(!d)return t((...t)=>{n(...t)},r,a);const m=()=>{const t=i.partialize({...r()});return d.setItem(i.name,{state:t,version:i.version})},f=a.setState;a.setState=(t,e)=>{f(t,e),m()};const v=t((...t)=>{n(...t),m()},r,a);let h;a.getInitialState=()=>v;const g=()=>{var t,e;if(!d)return;c=!1,l.forEach(t=>{var e;return t(null!=(e=r())?e:v)});const s=(null==(e=i.onRehydrateStorage)?void 0:e.call(i,null!=(t=r())?t:v))||void 0;return o(d.getItem.bind(d))(i.name).then(t=>{if(t){if("number"!=typeof t.version||t.version===i.version)return[!1,t.state];if(i.migrate){const e=i.migrate(t.state,t.version);return e instanceof Promise?e.then(t=>[!0,t]):[!0,e]}}return[!1,void 0]}).then(t=>{var e;const[s,o]=t;if(h=i.merge(o,null!=(e=r())?e:v),n(h,!0),s)return m()}).then(()=>{null==s||s(h,void 0),h=r(),c=!0,u.forEach(t=>t(h))}).catch(t=>{null==s||s(void 0,t)})};return a.persist={setOptions:t=>{i={...i,...t},t.storage&&(d=t.storage)},clearStorage:()=>{null==d||d.removeItem(i.name)},getOptions:()=>i,rehydrate:()=>g(),hasHydrated:()=>c,onHydrate:t=>(l.add(t),()=>{l.delete(t)}),onFinishHydration:t=>(u.add(t),()=>{u.delete(t)})},i.skipHydration||g(),h||v},i=e=>(n,r,s)=>(s.setState=(e,r,...s)=>{const o="function"==typeof e?t(e):e;return n(o,r,...s)},e(s.setState,r,s));export{s as a,n as c,i,a as p,r as s};
